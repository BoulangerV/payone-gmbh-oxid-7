<dl>
    <dt>
        <input id="payment_{{ sPaymentID }}" type="radio" name="paymentid" value="{{ sPaymentID }}"
               {% if oView.getCheckedPaymentId() == paymentmethod.oxpayments__oxid.value %}checked{% endif %}>
        <label for="payment_{{ sPaymentID }}"><b>{{ translate({ ident: paymentmethod.oxpayments__oxdesc.value }) }}</b></label>
    </dt>
    <dd class="{% if oView.getCheckedPaymentId() == paymentmethod.oxpayments__oxid.value %}activePayment{% endif %}">
        <input type="hidden" name="fcpo_mode_{{ sPaymentID }}" value="{{ paymentmethod.fcpoGetOperationMode() }}">
        <input type="hidden" name="dynvalue[fcpopl_secinstallment_account_holder]"
               value="{{ oView.fcpoGetAccountHolder() }}"/>

        {% set installmentOptions = oView.fcpoGetBNPLInstallment() %}
        {% if installmentOptions.status != 'OK' or installmentOptions.plans|length < 1 %}
        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", function (event) {
                var aPaymentSelectionButtons = document.getElementsByName("paymentid");
                aPaymentSelectionButtons.forEach(function (oElem) {
                    oElem.addEventListener('click', function (event) {
                        var oPaymentConfirmButton = document.getElementById("paymentNextStepBottom");
                        oPaymentConfirmButton.disabled = (event.target.value == 'fcpopl_secinstallment');)
                    });
                });
            });
        </script>
        <div class="warning">
            {{ translate({ ident: 'FCPO_BNPL_SECINSTALLMENT_UNAVAILABLE' }) }}
        </div>
        {% else %}
        <ul class="form">
            {% if oView.fcpoBNPLShowBirthdate() %}
            <li>
                <label class="req control-label col-lg-3">{{ translate({ ident: "FCPO_SECINVOICE_BIRTHDATE" }) }}:</label>
                <select name="dynvalue[fcpopl_secinstallment_birthdate_day]">
                    {% for sDay in oView.fcpoGetDayRange() %}
                    <option value="{{ sDay }}" {% if sDay == oView.fcpoGetBirthdayField('day') %}selected{% endif %}>
                        {{ sDay }}
                    </option>
                    {% endfor %}
                </select>
                &nbsp;
                <select name="dynvalue[fcpopl_secinstallment_birthdate_month]">
                    {% for sMonth in oView.fcpoGetMonthRange() %}
                    <option value="{{ sMonth }}" {% if sMonth == oView.fcpoGetBirthdayField('month') %}selected{% endif %}>
                        {{ sMonth }}
                    </option>
                    {% endfor %}
                </select>
                &nbsp;
                <select name="dynvalue[fcpopl_secinstallment_birthdate_year]">
                    {% for sYear in oView.fcpoGetYearRange() %}
                    <option value="{{ sYear }}" {% if sYear == oView.fcpoGetBirthdayField('year') %}selected{% endif %}>
                        {{ sYear }}
                    </option>
                    {% endfor %}
                </select>
            </li>
            {% endif %}

            {% if oView.fcpoBNPLShowFon() %}
            <li>
                <label class="req control-label col-lg-3">{{ translate({ ident: "FCPO_BNPL_FON" }) }}:</label>
                <div class="col-lg-9">
                    <input placeholder="{{ translate({ ident: "FCPO_BNPL_FON" }) }}" class="form-control" type="text"
                           size="20" maxlength="64" name="dynvalue[fcpopl_secinstallment_fon]"
                           value="{{ oView.fcpoGetUserValue('oxfon') }}" required="required">
                </div>
            </li>
            {% endif %}

            <li>
                <label>{{ translate({ ident: "FCPO_BANK_IBAN" }) }}:</label>
                <input placeholder="{{ translate({ ident: "FCPO_BANK_IBAN" }) }}" autocomplete="off" type="text" size="20"
                       maxlength="64" name="dynvalue[fcpopl_secinstallment_iban]"
                       value="{{ dynvalue.fcpopl_secinstallment_iban }}"
                       onkeyup="fcHandleDebitInputs('{{ oView.fcpoGetBICMandatory() }}]');return false;">
                <div id="fcpopl_secinstallment_iban_invalid" class="fcpo_check_error">
                    <p class="oxValidateError" style="display: block;">
                        {{ translate({ ident: "FCPO_IBAN_INVALID" }) }}
                    </p>
                </div>
            </li>
        </ul>

        {% include "@fcpayone/frontend/fcpo_payment_bnpl_snippet.html.twig" %}

        {% block checkout_payment_longdesc %}
        {% if paymentmethod.oxpayments__oxlongdesc.value %}
    <div>
        {{ paymentmethod.oxpayments__oxlongdesc.getRawValue() }}
        </div>
        {% endif %}
        {% endblock %}

        <li>
            <label class="req control-label col-lg-3">{{ translate({ ident: "FCPO_BNPL_SECINSTALLMENT_SELECTION" }) }}:</label>
            <div class="col-lg-9">
                <div></div>
                {% for index, plan in installmentOptions.plans %}
                <div>
                    <input id="bnplPlan_{{ index }}" type="radio" name="dynvalue[fcpopl_secinstallment_plan]"
                           value="{{ plan.installmentOptionId }}" onclick="fcpoSelectBNPLInstallmentPlan({{ index }})"/>
                    <a href="#" onclick="fcpoSelectBNPLInstallmentPlan({{ index }})">
                        {{ plan.monthlyAmountValue }} {{ plan.monthlyAmountCurrency }}
                        {{ translate({ ident: 'FCPO_PAYOLUTION_INSTALLMENT_PER_MONTH' }) }} - {{ plan.numberOfPayments }}
                        {{ translate({ ident: 'FCPO_PAYOLUTION_INSTALLMENT_RATES' }) }}
                    </a>
                </div>
                {% endfor %}
            </div>
        </li>

        <li>
            <div class="col-lg-3"></div>
            <div class="col-lg-9">
                {% for index, plan in installmentOptions.plans %}
                <div id="bnpl_installment_overview_{{ index }}" class="bnpl_installment_overview" style="display: none">
                    <strong>{{ translate({ ident: 'FCPO_BNPL_SECINSTALLMENT_OVW_TITLE' }) }}</strong>
                    <br/>
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-lg-3">{{ translate({ ident: 'FCPO_BNPL_SECINSTALLMENT_OVW_NBRATES' }) }}:</div>
                            <div class="col-lg-4 fcpopl-secinstallment-table-value">{{ plan.numberOfPayments }}</div>
                        </div>

                        <div class="row">
                            <div class="col-lg-3">{{ translate({ ident: 'FCPO_BNPL_SECINSTALLMENT_OVW_TOTALFINANCING' }) }}:
                            </div>
                            <div class="col-lg-4 fcpopl-secinstallment-table-value">{{ installmentOptions.amountValue }}
                                {{ installmentOptions.amountCurrency }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-3">{{ translate({ ident: 'FCPO_BNPL_SECINSTALLMENT_OVW_TOTALAMOUNT' }) }}:
                            </div>
                            <div class="col-lg-4 fcpopl-secinstallment-table-value">{{ plan.totalAmountValue }}
                                {{ plan.totalAmountCurrency }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-3">{{ translate({ ident: 'FCPO_BNPL_SECINSTALLMENT_OVW_INTEREST' }) }}:</div>
                            <div class="col-lg-4 fcpopl-secinstallment-table-value">{{ plan.nominalInterestRate }}%</div>
                        </div>

                        <div class="row">
                            <div class="col-lg-3">{{ translate({ ident: "FCPO_BNPL_SECINSTALLMENT_OVW_EFFECTIVEINTEREST" }) }}:
                            </div>
                            <div class="col-lg-4 fcpopl-secinstallment-table-value">{{ plan.effectiveInterestRate }}%
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-3">{{ translate({ ident: 'FCPO_BNPL_SECINSTALLMENT_OVW_MONTHLYRATE' }) }}:
                            </div>
                            <div class="col-lg-4 fcpopl-secinstallment-table-value">{{ plan.monthlyAmountValue }}
                                {{ plan.monthlyAmountCurrency }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                <br/>
                                <a target="_blank"
                                   href="{{ plan.linkCreditInformationHref }}">{{ translate({ ident: "FCPO_BNPL_SECINSTALLMENT_OVW_DL_CREDINFO" }) }}</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </li>

        <div class="warning">
            {{ translate({ ident: 'FCPO_BNPL_TNC_DATAPROTECTION_NOTICE' }) }}
        </div>
        {% endif %}

    </dd>
</dl>

