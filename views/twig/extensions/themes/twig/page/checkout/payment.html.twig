{% extends 'page/checkout/payment.html.twig' %}

{% block checkout_payment_errors %}
    {{ parent() }}

    {% set iPayError = oView.getPaymentError() %}
    {% if iPayError == -20 %}
        {% if attribute(oViewConf, 'getActiveTheme') is defined and oViewConf.getActiveTheme() == 'flow' %}
            <div class="alert alert-danger">{{ oView.getPaymentErrorText() }}</div>
        {% else %}
            <div class="status error">{{ oView.getPaymentErrorText() }}</div>
        {% endif %}
    {% endif %}

    {% for sUserFlagMessage in oView.fcpoGetUserFlagMessages() %}
        {% if sCurrentThemeName == 'flow' %}
            <div class="alert alert-info">{{ sUserFlagMessage }}</div>
        {% else %}
            <div class="status info">{{ sUserFlagMessage }}</div>
        {% endif %}
    {% endfor %}
{% endblock %}

{% block change_payment %}
    <script type="text/javascript">
        var oFcPayOneData = oFcPayOneData || [];
        oFcPayOneData.inputs =
            {
                fcpo_mid: '{{ oView.getMerchantId() }}',
                fcpo_portalid: '{{ oView.getPortalId() }}',
                fcpo_encoding: '{{ oView.getEncoding() }}',
                fcpo_aid: '{{ oView.getSubAccountId() }}',
                fcpo_amount: '{{ oView.getAmount() }}',
                fcpo_currency: '{{ currency.name }}',
                fcpo_tpllang: '{{ oView.getTplLang() }}',
                fcpo_bill_country: '{{ oView.fcGetBillCountry() }}',
                dynvalue_fcpo_pseudocardpan: '',
                dynvalue_fcpo_ccmode: '',
                fcpo_checktype: '{{ oView.getChecktype() }}',
                fcpo_hashelvWith: '{{ oView.getHashELVWithChecktype() }}',
                fcpo_hashelvWithout: '{{ oView.getHashELVWithoutChecktype() }}',
                fcpo_integratorid: '{{ oView.getIntegratorid() }}',
                fcpo_integratorver: '{{ oView.getIntegratorver() }}',
                fcpo_integratorextver: '{{ oView.getIntegratorextver() }}'
            };
    </script>

    {% if oViewConf.fcpoAmazonLoginSessionActive() %}
        {% set sFcPoTemplatePath = oView.fcpoGetActiveThemePath() %}
        {% if oView.getAllSets() %}
            {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_amazonpay_payment.html.twig" %}
        {% else %}
            {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_amazonpay_wrong_address.html.twig" %}
        {% endif %}
    {% else %}
        {{ style({ include: oViewConf.getModuleUrl("fcpayone", "css/fcPayOne.css") }) }}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block select_payment %}
    {% set aFcPoCCPaymentMetaData = oView.fcpoGetCCPaymentMetaData() %}
    {% set aFcPoOnlinePaymentMetaData = oView.fcpoGetOnlinePaymentMetaData() %}
    {% set dynvalue = oView.getDynValue() %}
    {% set sFcPoTemplatePath = oView.fcpoGetActiveThemePath() %}

    {% if oView.fcpoShowAsRegularPaymentSelection(sPaymentID) == false %}
        {# Don't show this payment in standard checkout => mostly express payments #}
    {% elseif sPaymentID == "fcpocreditcard" and oView.fcpoGetCreditcardType() == "ajax" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_creditcard_ajax.html.twig" %}
    {% elseif sPaymentID == "fcpocreditcard" and oView.fcpoGetCreditcardType() == "hosted" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_creditcard_hosted.html.twig" %}
    {% elseif sPaymentID == "fcpodebitnote" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_debitnote.html.twig" %}
    {% elseif sPaymentID == "fcpoklarna" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_klarna.html.twig" %}
    {% elseif sPaymentID == "fcpopo_bill" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_payolution_bill.html.twig" %}
    {% elseif sPaymentID == "fcpopo_debitnote" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_payolution_debitnote.html.twig" %}
    {% elseif sPaymentID == "fcpopo_installment" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_payolution_installment.html.twig" %}
    {% elseif sPaymentID == "fcporp_bill" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_ratepay_bill.html.twig" %}
    {% elseif sPaymentID == "fcporp_debitnote" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_ratepay_debitnote.html.twig" %}
    {% elseif sPaymentID == "fcpo_secinvoice" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_secinvoice.html.twig" %}
    {% elseif sPaymentID == "fcpo_sofort" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_sofort.html.twig" %}
    {% elseif sPaymentID == "fcpo_trustly" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_trustly.html.twig" %}
    {% elseif sPaymentID == "fcpo_giropay" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_giropay.html.twig" %}
    {% elseif sPaymentID == "fcpo_eps" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_eps.html.twig" %}
    {% elseif sPaymentID == "fcpo_ideal" %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_ideal.html.twig" %}
    {% elseif oView.fcpoIsKlarnaCombined(sPaymentID) %}
        {% if oView.fcpoShowKlarnaCombined(sPaymentID) %}
            {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_klarna_combined.html.twig" %}
        {% endif %}
    {% elseif oViewConf.fcpoIsPayonePayment(sPaymentID) %}
        {% include "@fcpayone/frontend/" ~ oViewConf.getActiveTheme() ~ "/fcpo_payment_default.html.twig" %}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}
